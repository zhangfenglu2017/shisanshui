{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [],
  "mappings": "AAAA,IAAM,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;;;AAGjC,IAAM,QAAQ,GAAG,EAAE,CAAC,KAAK,CAAC;AACtB,aAAS,EAAE,CAAC,SAAS;;AAErB,YAAU,EAAE;AACV,kBAAc,EAAE,IAAI;AACpB,kBAAc,EAAE,KAAK;GACtB;;AAED,SAAO,EAAE;AACP,YAAQ,EAAE,IAAI;GACf;;AAED,QAAM,EAAE,kBAAY;AAClB,YAAQ,CAAC,QAAQ,GAAG,IAAI,CAAC;AACzB,MAAE,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;GACvC;;;AAGD,kBAAgB,EAAE,0BAAU,KAAK,EAAE;AACjC,QAAI,CAAC,cAAc,GAAG,KAAK,CAAC;GAC7B;;;AAGD,qBAAmB,EAAE,+BAAY;AAC/B,QAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;AAC5B,QAAI,CAAC,YAAY,EAAE,CAAC;GACrB;;;AAGD,wBAAsB,EAAE,kCAAY;AAClC,WAAO,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC;GACpC;;;AAGD,eAAa,EAAE,yBAAY;;;;AAIzB,QAAI,CAAC,cAAc,GAAG,IAAI,CAAC;;AAE3B,QAAI,CAAC,IAAI,CAAC,cAAc,EAAE;AACxB,QAAE,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;AACxB,UAAI,CAAC,YAAY,EAAE,CAAC;AACpB,aAAO;KACR;;AAED,QAAI,CAAC,gBAAgB,EAAE,CAAC;GACzB;;;AAGD,cAAY,EAAE,wBAAY;AACxB,QAAI,CAAC,cAAc,GAAG,KAAK,CAAC;AAC5B,QAAI,CAAC,sBAAsB,EAAE,CAAC;GAC/B;;;AAGD,eAAa,EAAE,yBAAY;AACzB,WAAO,IAAI,CAAC,cAAc,CAAC;GAC5B;;;AAGD,kBAAgB,EAAE,4BAAY;AAC5B,QAAI,SAAS,GAAG,GAAG,CAAC;AACpB,QAAI,QAAQ,GAAG,GAAG,CAAC;AACnB,MAAE,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;;;;;AAK5B,QAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,CAAA,UAAS,MAAM,EAAE,KAAK,EAAE;AACvE,UAAI,KAAK,IAAI,IAAI,CAAC,cAAc,CAAC,MAAM,GAAG,CAAC,EAAE;AAC3C,eAAO,IAAI,CAAC;OACb;;AAED,aAAQ,MAAM,CAAC,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC,CAAE;KACrD,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;;AAEd,QAAI,CAAC,cAAc,CAAC,OAAO,CAAC,CAAA,UAAU,IAAI,EAAE,KAAK,EAAE;AACjD,UAAI,KAAK,GAAG,SAAS,GAAG,KAAK,GAAG,QAAQ,CAAC;AACzC,UAAI,KAAK,IAAI,IAAI,CAAC,cAAc,CAAC,MAAM,GAAG,CAAC,EAAE;;AAE3C,aAAK,GAAG,SAAS,GAAG,CAAC,KAAK,GAAG,CAAC,CAAA,GAAI,QAAQ,GAAG,CAAC,CAAC;OAChD;;AAED,UAAI,CAAC,YAAY,CAAC,YAAY;AAC5B,UAAE,CAAC,GAAG,CAAC,0BAA0B,EAAE,KAAK,CAAC,CAAC;AAC1C,cAAM,CAAC,QAAQ,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;OACzC,EAAE,KAAK,CAAC,CAAC;KAEX,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;GAEf;;CAEJ,CAAC,CAAC;;AAEH,MAAM,CAAC,OAAO,GAAG,QAAQ,CAAC",
  "file": "unknown",
  "sourcesContent": [
    "const Socket = require('socket');\n\n// 用于回放的组件\nconst Playback = cc.Class({\n    extends: cc.Component,\n\n    properties: {\n      _playbackDatas: null,   // 用于回放的数据\n      _isPlaybacking: false,\n    },\n\n    statics: {\n      instance: null,\n    },\n\n    onLoad: function () {\n      Playback.instance = this;\n      cc.game.addPersistRootNode(this.node);\n    },\n\n    // 设置回放数据\n    setPlaybackDatas: function (datas) {\n      this._playbackDatas = datas;\n    },\n\n    // 清空回放数据。同时会清空回放\n    removePlaybackDatas: function () {\n      this.setPlaybackDatas(null);\n      this.stopPlayback();\n    },\n\n    // 是否包含回放数据\n    isContainPlaybackDatas: function () {\n      return this._playbackDatas != null;\n    },\n\n    // 开始回放\n    startPlayback: function () {\n      // 模拟 socket 接收到了事件即可\n      //cc.log(\"Playback 开始回放\");\n\n      this._isPlaybacking = true;\n\n      if (!this._playbackDatas) {\n        cc.error(\"想回放，却没有回放数据\");\n        this.stopPlayback();\n        return;\n      }\n\n      this._executePlayback();\n    },\n\n    // 停止回放\n    stopPlayback: function () {\n      this._isPlaybacking = false;\n      this.unscheduleAllCallbacks();\n    },\n\n    // 是否正在回放\n    isPlaybacking: function () {\n      return this._isPlaybacking;\n    },\n\n    // 执行真正的回放操作\n    _executePlayback: function () {\n      let startTime = 1.0;\n      let interval = 3.0;\n      cc.log(this._playbackDatas);\n\n      // 在某些特殊情况下\n      // 回放数据里会包含两套 gameOver action\n      // 所以需要过滤掉其中一个\n      this._playbackDatas = this._playbackDatas.filter(function(string, index) {\n        if (index == this._playbackDatas.length - 1) {\n          return true;\n        }\n\n        return (string.indexOf('\"action\":\"gameOver') == -1);\n      }.bind(this));\n\n      this._playbackDatas.forEach(function (data, index) {\n        var delay = startTime + index * interval;\n        if (index == this._playbackDatas.length - 1) {\n          // 如果是最后一个，则应该只间隔一秒\n          delay = startTime + (index - 1) * interval + 1;\n        }\n\n        this.scheduleOnce(function () {\n          cc.log(\"回放开始模拟 Socket 接收到服务器消息, \", index);\n          Socket.instance._dispatchResponse(data);\n        }, delay);\n\n      }.bind(this));\n\n    },\n\n});\n\nmodule.exports = Playback;\n"
  ]
}