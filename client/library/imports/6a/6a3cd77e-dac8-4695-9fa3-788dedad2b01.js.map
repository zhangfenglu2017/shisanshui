{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "const KQCard = require('KQCard');\r\nconst AudioManager = require('AudioManager');\r\n\r\nlet ResultStatus = {\r\n  WIN: 2,\r\n  DRAW: 1,\r\n  LOSE: 0,\r\n};\r\n\r\n\r\nlet GameResult = cc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    winNode: cc.Node,\r\n    loseNode: cc.Node,\r\n    drawNode: cc.Node,\r\n    contentNode: cc.Node,\r\n\r\n    resultItems: [cc.Node],\r\n\r\n    _deskInfo: null,\r\n    _userId: null,\r\n    _closeCallback: null,\r\n  },\r\n\r\n  // use this for initialization\r\n  onLoad: function () {\r\n    this._hideResultItems();\r\n  },\r\n\r\n  showResults: function (deskInfo, currentUserId) {\r\n    this._deskInfo = deskInfo;\r\n    this._userId = currentUserId;\r\n\r\n    let resultStatus = this._resultStatus();\r\n    this.contentNode.active = true;\r\n    this.winNode.active =  (resultStatus == ResultStatus.WIN);\r\n    this.drawNode.active = (resultStatus == ResultStatus.DRAW);\r\n    this.loseNode.active = (resultStatus == ResultStatus.LOSE);\r\n\r\n    if (this.winNode.active) {\r\n      AudioManager.instance.playWin();\r\n    } else if (this.loseNode.active) {\r\n      AudioManager.instance.playLose();\r\n    }\r\n\r\n    this.node.getComponent('alert').alert();\r\n    this.node.getComponent('alert').setDismissCallback(function () {\r\n      this._closeCallback\r\n    }.bind(this));\r\n\r\n    let playerInfos = deskInfo.players.sort(function (p1, p2) {\r\n      return p2.cScore - p1.cScore;\r\n    });\r\n    let itemComps = this.resultItems.map(function (node) {\r\n      return node.getComponent('ResultItem');\r\n    });\r\n    itemComps.forEach(function (itemComp, index) {\r\n      itemComp.node.active = index < playerInfos.length;\r\n      if (!itemComp.node.active) {\r\n        return;\r\n      }\r\n\r\n      let user = playerInfos[index];\r\n      itemComp.updateWithPlayerInfo(user, deskInfo.isRandomDesk);\r\n      let cards = this._cardsFromUser(user);\r\n      itemComp.setCards(cards);\r\n    }.bind(this));\r\n  },\r\n\r\n  setCloseCallback: function (callback) {\r\n    this._closeCallback = callback;\r\n  },\r\n\r\n  _cardsFromUser: function (user) {\r\n    let cards = user.cardInfo.map(function (cardInfoItem) {\r\n      return KQCard.cardsFromArray(cardInfoItem.cards);\r\n    }).reduce(function (array, subCards) {\r\n      return array.concat(subCards);\r\n    }, []);\r\n\r\n    return cards;\r\n  },\r\n\r\n  _hideResultItems: function () {\r\n    this.resultItems.forEach(function (node) {\r\n      node.acitve = false;\r\n    });\r\n  },\r\n\r\n  _resultStatus: function() {\r\n    let playerInfos = this._deskInfo.players;\r\n    let user = playerInfos.find(function (user) {\r\n      return user.id == this._userId;\r\n    }.bind(this));\r\n\r\n    let score = user.cScore;\r\n    if (this._deskInfo.isRandomDesk) {\r\n      // 如果是随机场的话，应该用钻石来判断输赢\r\n      score = user.diamond;\r\n    }\r\n\r\n    if (score > 0) {\r\n      return ResultStatus.WIN;\r\n    } else if (score < 0) {\r\n      return ResultStatus.LOSE;\r\n    }\r\n\r\n    return ResultStatus.DRAW;\r\n  },\r\n});\r\n\r\nmodule.exports = GameResult;\r\n"
  ]
}