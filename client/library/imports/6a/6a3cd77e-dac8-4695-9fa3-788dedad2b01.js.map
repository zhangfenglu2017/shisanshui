{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "const KQCard = require('KQCard');\nconst AudioManager = require('AudioManager');\n\nlet ResultStatus = {\n  WIN: 2,\n  DRAW: 1,\n  LOSE: 0,\n};\n\n\nlet GameResult = cc.Class({\n  extends: cc.Component,\n\n  properties: {\n    winNode: cc.Node,\n    loseNode: cc.Node,\n    drawNode: cc.Node,\n    contentNode: cc.Node,\n\n    resultItems: [cc.Node],\n\n    _deskInfo: null,\n    _userId: null,\n    _closeCallback: null,\n  },\n\n  // use this for initialization\n  onLoad: function () {\n    this._hideResultItems();\n  },\n\n  showResults: function (deskInfo, currentUserId) {\n    this._deskInfo = deskInfo;\n    this._userId = currentUserId;\n\n    let resultStatus = this._resultStatus();\n    this.contentNode.active = true;\n    this.winNode.active =  (resultStatus == ResultStatus.WIN);\n    this.drawNode.active = (resultStatus == ResultStatus.DRAW);\n    this.loseNode.active = (resultStatus == ResultStatus.LOSE);\n\n    if (this.winNode.active) {\n      AudioManager.instance.playWin();\n    } else if (this.loseNode.active) {\n      AudioManager.instance.playLose();\n    }\n\n    this.node.getComponent('alert').alert();\n    this.node.getComponent('alert').setDismissCallback(function () {\n      this._closeCallback\n    }.bind(this));\n\n    let playerInfos = deskInfo.players.sort(function (p1, p2) {\n      return p2.cScore - p1.cScore;\n    });\n    let itemComps = this.resultItems.map(function (node) {\n      return node.getComponent('ResultItem');\n    });\n    itemComps.forEach(function (itemComp, index) {\n      itemComp.node.active = index < playerInfos.length;\n      if (!itemComp.node.active) {\n        return;\n      }\n\n      let user = playerInfos[index];\n      itemComp.updateWithPlayerInfo(user, deskInfo.isRandomDesk);\n      let cards = this._cardsFromUser(user);\n      itemComp.setCards(cards);\n    }.bind(this));\n  },\n\n  setCloseCallback: function (callback) {\n    this._closeCallback = callback;\n  },\n\n  _cardsFromUser: function (user) {\n    let cards = user.cardInfo.map(function (cardInfoItem) {\n      return KQCard.cardsFromArray(cardInfoItem.cards);\n    }).reduce(function (array, subCards) {\n      return array.concat(subCards);\n    }, []);\n\n    return cards;\n  },\n\n  _hideResultItems: function () {\n    this.resultItems.forEach(function (node) {\n      node.acitve = false;\n    });\n  },\n\n  _resultStatus: function() {\n    let playerInfos = this._deskInfo.players;\n    let user = playerInfos.find(function (user) {\n      return user.id == this._userId;\n    }.bind(this));\n\n    let score = user.cScore;\n    if (this._deskInfo.isRandomDesk) {\n      // 如果是随机场的话，应该用钻石来判断输赢\n      score = user.diamond;\n    }\n\n    if (score > 0) {\n      return ResultStatus.WIN;\n    } else if (score < 0) {\n      return ResultStatus.LOSE;\n    }\n\n    return ResultStatus.DRAW;\n  },\n});\n\nmodule.exports = GameResult;\n"
  ]
}