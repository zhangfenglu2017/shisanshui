{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "var manager = require('manager');\r\nconst KQGlobalEvent = require('KQGlobalEvent');\r\nconst KQNativeInvoke = require('KQNativeInvoke');\r\n\r\nlet SocketConstant = {\r\n  MaxReconnectCheckInterval: 5, // 重连检测时间片\r\n};\r\n\r\n/**\r\n * 这是对 WebSocket 的一个封装\r\n * \r\n * 里面包含自动重连的功能\r\n */\r\nlet Socket = cc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    _lastReceiveMsgTime: 0, // 最后一次收到消息时间(毫秒)\r\n    _timeout: 8, // 超时时长 （秒）\r\n  },\r\n\r\n  statics: {\r\n    instance: null,\r\n    // url:\"ws://182.18.26.13:5041\",\r\n    //url:\"ws://123.56.20.164:5041\",//修改前\r\n    url:\"ws://127.0.0.1:5041\",\r\n    // url:\"ws://192.168.0.108:5041\",\r\n    //url:\"ws://183.3.205.149:5002\",\r\n  },\r\n\r\n  // use this for initialization\r\n  onLoad: function () {\r\n    Socket.instance = this;\r\n\r\n    this.name = \"socket\";\r\n\r\n    cc.game.addPersistRootNode(this.node);\r\n    if (cc.game.isPersistRootNode(this.node)) {\r\n      cc.log('添加全局节点 Socket 成功');\r\n    }\r\n\r\n    this._registerAppActiveChange();\r\n\r\n    this.isCreating = false;\r\n    this.createIndex = 0;\r\n    this.createSocket();\r\n\r\n    this.schedule(function () {\r\n      this.checkConnection();\r\n    }, 5);\r\n\r\n    this.recvTime = Date.now(); //接收到最新一条服务器的信息的时间\r\n    //cc.log(manager.version);\r\n\r\n    this._checkSocket();\r\n  },\r\n\r\n  checkConnection: function () {\r\n    //客户端定时给服务端发送点数据，防止连接由于长时间没有通讯而被某些节点的防火墙关闭导致连接断开的情况。\r\n    this.sendMessage('checkAction', '');\r\n  },\r\n\r\n  createSocket: function () {\r\n    var self = this;\r\n    this.createIndex++; //创建次数加1\r\n    if (this.createIndex > 5) {\r\n      this.networkError();\r\n      KQNativeInvoke.forceExitApp();\r\n      return;\r\n    }\r\n    this.isCreating = true;\r\n\r\n    KQGlobalEvent.emit(Socket.Event.SocketConnecting);\r\n    this.ws = new WebSocket(Socket.url);\r\n    if (this.ws === null) {\r\n      this.networkError();\r\n      KQGlobalEvent.emit(Socket.Event.SocketConnectError, {'data': 'Socket 创建失败'});\r\n      KQNativeInvoke.forceExitApp();\r\n      return;\r\n    }\r\n    this.socketError = false;\r\n\r\n    // socket 连接成功\r\n    this.ws.onopen = function (event) {\r\n      //cc.log(\"WebSocket 连接成功：\", event);\r\n      \r\n      self._lastReceiveMsgTime = cc.sys.now();\r\n      KQGlobalEvent.emit(Socket.Event.SocketConnectSuccessed, event);\r\n\r\n      self.isCreating = false;\r\n      self.socketError = false;\r\n      self.createIndex = 0;\r\n      self.connectionSuccess();\r\n      self.sendReconnectInfo();\r\n    };\r\n\r\n    // socket 接收到消息\r\n    this.ws.onmessage = function (event) {\r\n      self._lastReceiveMsgTime = cc.sys.now();\r\n      KQGlobalEvent.emit(Socket.Event.SocketReceiveMessage, event.data);\r\n\r\n      self.isCreating = false;\r\n      self.socketError = false;\r\n      self.receviceMessage(event.data);\r\n      self._dispatchResponse(event.data);\r\n      self.recvTime = Date.now(); //接收最新一条信息的时间\r\n\r\n      /**/\r\n    };\r\n\r\n    /**\r\n     * socket 发生错误\r\n     * \r\n     * socket 本身有 `onerror` 回调，但事实证明，其不靠谱，\r\n     * 有很大的机率有误报的行为，常常在没有错误时，会给错误回调。\r\n     * 且不能定制超时时长\r\n     * \r\n     * @param {String} message \r\n     */\r\n    this.ws._kq_onerror = function (message) {\r\n      cc.error(`WebSocket 连接错误：${message}`);\r\n\r\n      KQGlobalEvent.emit(Socket.Event.SocketConnectError, {data: message});\r\n      self.ws.close();\r\n      if (!self.ws) {\r\n        return;\r\n      }\r\n\r\n      // 虽然调用了 websocket 的 close 方法，但是\r\n      // 它并会立即调用 onclose 回调，而是在未来的某\r\n      // 一时间再回调 onclose；但这里明显可以直接回调了。\r\n      let ws = self.ws;\r\n\r\n      self.ws.onclose();\r\n      ws.onclose = function(){};\r\n    };\r\n\r\n    // socke 已关闭\r\n    this.ws.onclose = function (event) {\r\n      //cc.log('WebSocket 已关闭 close time=' + Date.now() + \" event: \" + event);\r\n\r\n\r\n      self.isCreating = false;\r\n      self.socketError = true;\r\n      self.ws = null;\r\n      self.connectionDisconnect();\r\n      KQGlobalEvent.emit(Socket.Event.SocketDisconnect, event);\r\n      //cc.log('socket close'+JSON.stringify(event));\r\n    };\r\n  },\r\n\r\n  reconnect: function () {\r\n    var self = this;\r\n    this.scheduleOnce(function () {\r\n      if (!self.isCreating && self.socketError) {\r\n        self.createSocket();\r\n      }\r\n    }, 2);\r\n  },\r\n\r\n  sendReconnectInfo: function () {\r\n    var self = this;\r\n    this.scheduleOnce(function () {\r\n      if (this.userInfo != null) {\r\n        var userId = self.userInfo.user_id || self.userInfo.id;\r\n        self.sendMessage('reconnect', {\r\n          'userId': userId\r\n        });\r\n      }\r\n    }, 1);\r\n  },\r\n\r\n  receviceMessage: function (response) {\r\n\r\n  },\r\n\r\n  connectionDisconnect: function () {\r\n\r\n  },\r\n\r\n  connectionSuccess: function () {\r\n\r\n  },\r\n\r\n  networkError: function () {\r\n\r\n  },\r\n\r\n  checkNetworkStart: function () {\r\n\r\n  },\r\n\r\n  checkNetworkEnd: function () {\r\n\r\n  },\r\n\r\n  _dispatchResponse: function (responseString) {\r\n    //cc.log(\"WebSocket 接收到服务器消息：\", responseString);\r\n    let response = JSON.parse(responseString);\r\n    let action = response[\"action\"];\r\n    if (action) {\r\n      KQGlobalEvent.emit(action, response);\r\n    }\r\n  },\r\n\r\n  // MARK: 前后台操作\r\n  _registerAppActiveChange: function () {\r\n    //cc.log(\"WebSocket 注册应用进入前、后台事件\");\r\n    cc.game.on(cc.game.EVENT_HIDE, this._appEnterBackground, this);\r\n    cc.game.on(cc.game.EVENT_SHOW, this._appBecomActive, this);\r\n  },\r\n\r\n  /**\r\n   * 进入后台\r\n   */\r\n  _appEnterBackground: function () {\r\n    let now = cc.sys.now();\r\n    if (now - this._lastAppEnterBackgroundTime < 100) {\r\n      return;\r\n    }\r\n    this._lastAppEnterBackgroundTime = now;\r\n    \r\n    //cc.log(\"WebSocket 检测到应用进入后台：\", new Date());\r\n    let id = this.userInfo ? this.userInfo.id : undefined;\r\n    Socket.sendAppPause(id);\r\n    this._cancelCheckSocket();\r\n  },\r\n\r\n  /**\r\n   * 进入前台 \r\n   */\r\n  _appBecomActive: function () {\r\n    let now = cc.sys.now();\r\n    if (now - this._lastAppBecomActiveTime < 100) {\r\n      return;\r\n    }\r\n    this._lastAppBecomActiveTime = now;\r\n\r\n    //cc.log(\"WebSocket 检测到应用进入前台：\", new Date());\r\n    let id = this.userInfo ? this.userInfo.id : undefined;\r\n    Socket.sendAppActive(id);\r\n    this._checkSocket();\r\n\r\n    this.scheduleOnce(function() {\r\n      this._checkSocketExecute();\r\n    }.bind(this), 1.5);\r\n  },\r\n\r\n  //进入后台操作\r\n  enterbackgroudAction: function () {\r\n    this._appEnterBackground();\r\n  },\r\n\r\n  //进入前台操作\r\n  resumeAction: function () {\r\n    //检查网络\r\n    this._checkNetwork();\r\n    this._appBecomActive();\r\n  },\r\n\r\n  sendMessage: function (action, data) {\r\n    data = this._strongVerifyData(data);\r\n\r\n    if (this.socketError) {\r\n      cc.error(\"socket 连接错误：\" + this.socketError);\r\n      this.reconnect();\r\n      return;\r\n    }\r\n    //cc.log('WebSocket 发送消息：' + action, data);\r\n    if (cc.sys.isObjectValid(this.ws)) {\r\n      if (this.ws.readyState === WebSocket.OPEN) {\r\n        this.ws.send(this._convertParameterToString(action, data));\r\n      }\r\n    } else {\r\n      this.connectionDisconnect();\r\n    }\r\n  },\r\n\r\n  _strongVerifyData: function(data = {}) {\r\n    if ((typeof data) == 'string') {\r\n      data = {\"string\": data};\r\n    }\r\n\r\n    if (data == null) {\r\n      data = {};\r\n    }\r\n\r\n    if (!data[\"userId\"]) {\r\n      if (this.userInfo && (typeof this.userInfo) == 'object' && this.userInfo.id) {\r\n        data[\"userId\"] = this.userInfo.id;\r\n      }\r\n\r\n    }\r\n    return data;\r\n  },\r\n\r\n  _convertParameterToString: function (action, data = {}) {\r\n    var obj = {};\r\n    obj.action = action;\r\n    obj.data = data;\r\n    \r\n    return JSON.stringify(obj);\r\n  },\r\n\r\n  // 检查网络\r\n  _checkNetwork: function () {\r\n    if (this.checkNetworkNow) {\r\n      this.checkNetworkNow();\r\n    }\r\n\r\n    this.shouldCheck = true;\r\n    if (!this.socketError) {\r\n      this.recvTime = 0;\r\n      this.sendMessage('checkAction', '');\r\n      this.scheduleOnce(function () {\r\n        this.checkNetworkEnd();\r\n        this.shouldCheck = false;\r\n        if (this.recvTime === 0) {\r\n          this.connectionDisconnect();\r\n        }\r\n      }, 2.5);\r\n    } else {\r\n      this.connectionDisconnect();\r\n    }\r\n  },\r\n\r\n  // MARK: socket 掉线尽早确认\r\n  _checkSocket: function () {\r\n    this.schedule(this._checkSocketExecute, SocketConstant.MaxReconnectCheckInterval, cc.macro.REPEAT_FOREVER);\r\n  },\r\n\r\n  _cancelCheckSocket: function () {\r\n    this.unschedule(this._checkSocketExecute);\r\n  },\r\n\r\n  _checkSocketExecute: function () {\r\n    if (this._isSocketTimeout() && this.ws) {\r\n      this.ws._kq_onerror('连接超时');\r\n      return;\r\n    }\r\n  },\r\n\r\n  // socket 是否已超时\r\n  _isSocketTimeout: function () {\r\n    return this._lastReceiveMessageInterval() >= this._timeout;\r\n  },\r\n\r\n  // 上一次收到消息到现在的时间间隔\r\n  _lastReceiveMessageInterval: function () {\r\n    let now = cc.sys.now();\r\n    let interval = (now - this._lastReceiveMsgTime) / 1000;\r\n    //cc.log(`WebSocket 现在距上一条收到消息的时间间隔是：${interval} 秒`);\r\n    return interval;\r\n  },\r\n\r\n});\r\n\r\n// MARK: Socket 事件定义\r\nSocket.Event = {\r\n  SocketConnecting: \"SocketConnecting\",             // Socket 正在连接\r\n  SocketConnectSuccessed: \"SocketConnectSuccessed\", // 连接成功\r\n  SocketDisconnect: \"SocketDisconnect\",         // Socket 断开连接\r\n  SocketConnectError: \"SocketConnectError\",     // Socket 连接错误\r\n  SocketReceiveMessage: \"SocketReceiveMessage\", // Socket 接收到消息\r\n\r\n  LoginJoin:\"loginJoin\",                // 客户端发送 从登陆界面获取房间号进入游戏\r\n  RecordId:\"recordId\",                  // 客户端发送  \r\n  OnceAgain:\"onceAgain\",                  // 客户端发送  \r\n  BeiLv: \"beiLv\",                       // 客户端发送  \r\n  InviteCode: \"inviteCode\",             // 客户端发送   邀请码\r\n  JoinDesk: \"joinDesk\",                 // 客户端发送\r\n  CreateDesk: \"createDesk\",             // 客户端发送\r\n  GetDaiKaiDesk:\"getDaiKaiDesk\",        //代开房数据获取\r\n  LeaveDesk: \"leaveDesk\",               // 离开桌子\r\n  DissolveDesk: \"dissolveDesk\",         // 解散桌子\r\n  AnswerDissolve: \"answerDissolve\",     // 回答请求退出命令\r\n  GetDeskInfo: \"getDeskInfo\",           // 客户端发送\r\n  SendImage: \"sendImage\",               // 客户端发送\r\n  SendText: \"sendText\",                 // 客户端发送\r\n  SendEmoji: \"sendEmoji\",               // 客户端发送\r\n  ChangeInfo:\"changeInfo\",              // 客户端发送\r\n  SendAudioMessage: \"sendAudioMessage\", // 客户端发送  发送语音消息\r\n  GetRecord: \"getRecord\",               // 获取战绩信息\r\n  GetItemRecord: \"getItemRecord\",       // 获取战绩信息\r\n  PlayCard: \"playCard\",                 // 客户端发送，用户打出牌\r\n  TimeoutDissolve: \"timeoutDissolve\",   // 请求退出超时时，需要发出的消息\r\n  Feedback: \"feedback\",         // 客户端发送  反馈信息\r\n  SharePng: \"sharePng\",         // 客户端发送  分享领取砖石\r\n  EnterRandom: \"interRandom\",   // 客户端发送  进入随机场\r\n  CancelRandom: \"cancelRandom\", // 客户端发送  取消进入随机场\r\n  ForceExitRandom: \"dissolve\",  // 客户端发送 强制退出随机场\r\n  Ready: \"ready\",               // 客户端发送 准备\r\n  StartGame: \"startGame\", // 客户端发送 开始游戏\r\n  GetHallInfo: \"getHallInfo\",   // 客户端发送 获取大厅信息\r\n  GetUserInfo: \"getUserInfo\",   // 客户端发送 获取用户信息\r\n  CheckAction: \"checkAction\",   // 客户端发送，用来检测与服务器的连通性\r\n  Pause: \"pause\",               // 客户端进入后台时要发送的消息\r\n  Active: \"active\",             // 客户端回到前台时要发送的消息\r\n  Qingli: \"qingli\",             // 客户端回到前台时要发送的消息\r\n\r\n  ReceiveRequestDissolve: \"requestDissolve\", // 请求解散桌子 服务器发送\r\n  ReceiveRequestDissolveResult: \"requestDissolveResult\", // 请求解散桌子结果\r\n  ReceiveChatText: \"sendText\",    // 服务器发送\r\n  ReceiveChatEmoji: \"sendEmoji\",  // 服务器发送\r\n  ReceiveDeskInfo: \"deskInfo\",    // 服务器发送\r\n  ReceiveGameOver: \"gameOver\",    // 服务器发送\r\n  ReceiveFaPai: \"fapai\",          // 服务器发送\r\n  ReceiveSharePng: \"sharePngs\",   // 服务器发送\r\n  ReceiveOnlineStatus: \"sendOnlineStatus\",  // 服务器发送\r\n  ReceiveOnChangeInfo: \"changeInfo\",        // 服务器发送\r\n  ReceiveAudioMessage: \"sendAudioMessage\",  // 服务器发送，接收到用户发送了语音消息\r\n  ReceivePlayCard: \"playCard\",              // 服务器发送，有用户已经准备好牌\r\n  ReceiveCreateDesk: \"createDesk\",          // 服务器发送，创建房间的回调\r\n  ReceiveGetDaiKaiDesk:\"getDaiKaiDesk\",     // 服务器发送，代开房间 已开房间数据\r\n  ReceiveDaiKaiDesk: \"daikaiDesk\",          // 服务器发送，代开房间的回调\r\n  ReceiveReady: \"ready\",                    // 服务器发送，有用户点击了准备\r\n  ReceiveHallInfo: \"getHallInfo\",           // 服务器发送\r\n  ReceiveGetUserInfo: \"getUserInfo\",        // 服务器发送 获取用户信息\r\n  ReceiveCheckAction: \"checkAction\",        // 服务器发送  用来确认 Socket 还在连着\r\n  ReceiveForceExit: \"forceExit\",            // 服务器发送  用来使客户端强退\r\n  ReceiveDissolveDesk: \"dissolveDesk\",      // 服务器发送   当房主退出时，解散桌子\r\n  ReceiveInterRandom: \"interRandom\",        // 服务器发送   进入随机场的反馈\r\n  ReceivePause: \"pause\",                    // 服务器发送   当有用户设备进入后台时，会收到这条消息\r\n  ReceiveInviteCode: 'inviteCode',          // 服务器发送，收到邀请码的消息\r\n  ReceiveLeaveDesk: 'leaveDesk',            // 服务器发送，收到需要离开桌子的消息\r\n  ReceiveSelectBeiLv: 'selectBeiLv',        // 服务器发送，收到选择倍率的消息\r\n  ReceiveBeiLv:'beiLv',                     // 服务器发送，收到倍率的消息\r\n  ReceiveQingLi:'qingli',                   // 服务器发送，收到请离\r\n  ReceiveRecordId:'recordId',               // 服务器发送，收到战绩信息\r\n  ReceiveLoginJoin:'loginJoin',             // 服务器发送，收到从页面进入房间信息\r\n  ReceiveOnceAgain:'onceAgain',             // 服务器发送，收到再来一局信息\r\n  ReceiveNoUionid:'noUionid',             // 服务器发送，收到没有unionID信号\r\n};\r\n\r\n\r\n// MARK: Socket 提供的可发给服务器消息的方法\r\n\r\nSocket.sendCheckAction = function() {\r\n  this.instance.sendMessage(this.Event.CheckAction, null);\r\n};\r\n/**/\r\nSocket.sendDidReceiveGameOverAction = function (userId) {\r\n  const param = userId ? {\"userId\": userId} : null;\r\n  this.instance.sendMessage(Socket.Event.DidReceiveGameOverAction, param);\r\n};\r\n/**/\r\n\r\n\r\n/**\r\n * 当 APP 进入后台时要发送的消息\r\n */\r\nSocket.sendAppPause = function(userId) {\r\n  let param = userId ? {\"userId\": userId} : null;\r\n  this.instance.sendMessage(this.Event.Pause, param);\r\n};\r\n\r\n/**\r\n * 当 APP 进入前台时发送的消息\r\n */\r\nSocket.sendAppActive = function(userId) {\r\n  let param = userId ? {\"userId\": userId} : null;\r\n  this.instance.sendMessage(this.Event.Active, param);\r\n};\r\n\r\n// 开房\r\nSocket.sendCreateDesk = function (createDescInfo, userId) {\r\n  cc.assert(createDescInfo);\r\n  cc.assert(userId);\r\n\r\n  createDescInfo[\"userId\"] = userId;\r\n  this.instance.sendMessage(this.Event.CreateDesk, createDescInfo);\r\n};\r\n\r\nSocket.sendQingli = function(leaveId,userId){\r\n let param = {\r\n    \"leaveId\": leaveId,\r\n    \"userId\": userId,\r\n  };\r\n  this.instance.sendMessage(this.Event.Qingli, param);\r\n};\r\n// 从登陆页面加入房间\r\nSocket.sendLoginJoin = function (roomId, userId) {\r\n  let param = {\r\n    \"roomId\": roomId,\r\n    \"userId\": userId,\r\n  };\r\n  this.instance.sendMessage(this.Event.LoginJoin, param);\r\n};\r\n// 再来一局\r\nSocket.sendOnceAgain = function (again,userId) {\r\n  let param = {\r\n    \"userId\": userId,\r\n    \"again\":again,\r\n  };\r\n  this.instance.sendMessage(this.Event.OnceAgain, param);\r\n};\r\n// 加入房间\r\nSocket.sendJoinDesk = function (roomId, userId) {\r\n  cc.assert(roomId);\r\n  cc.assert(userId);\r\n\r\n  let param = {\r\n    \"roomId\": roomId,\r\n    \"userId\": userId,\r\n  };\r\n  this.instance.sendMessage(this.Event.JoinDesk, param);\r\n};\r\n// 向服务端发送我选择的倍率\r\nSocket.sendBeiLv = function(beilv,userId){\r\n  let param = {\r\n    \"beilv\": beilv,\r\n    \"userId\": userId,\r\n  };\r\n  this.instance.sendMessage(this.Event.BeiLv, param);\r\n};\r\n// 发送邀请码\r\nSocket.sendInviteCode = function(inviteCode,userId){\r\n  let param = {\r\n    \"inviteCode\": inviteCode,\r\n    \"userId\": userId,\r\n  };\r\n  this.instance.sendMessage(this.Event.InviteCode, param);\r\n};\r\n\r\n// 获取房间信息\r\nSocket.sendGetDesckInfo = function (userId) {\r\n  cc.assert(userId);\r\n  let param = {\r\n    \"userId\": userId,\r\n  };\r\n\r\n  this.instance.sendMessage(this.Event.GetDeskInfo, param);\r\n};\r\n\r\nSocket.sendText = function (userId, text) {\r\n  //cc.assert(userId);\r\n  //cc.assert(text);\r\n  let param = {\r\n    \"msg\": text,\r\n    \"userId\": userId,\r\n  };\r\n  this.instance.sendMessage(this.Event.SendText, param);\r\n};\r\nSocket.sendEmoji = function(userId,emoji){\r\n  let param = {\r\n    \"emoji\": emoji,\r\n    \"userId\": userId,\r\n  };\r\n  this.instance.sendMessage(this.Event.SendEmoji, param);\r\n};\r\nSocket.sendChangeInfo = function(userId,Info){\r\n  let param = {\r\n    \"changeInfo\": Info,\r\n    \"userId\": userId,\r\n  };\r\n  this.instance.sendMessage(this.Event.ChangeInfo, param);\r\n};\r\nSocket.sendAudioMessage = function (userId, url = \"\") {\r\n  cc.assert(userId);\r\n  cc.assert(url.length > 0);\r\n\r\n  if (url.length == 0) {\r\n    return;\r\n  }\r\n\r\n  let param = {\r\n    \"url\": url,\r\n    \"userId\": userId,\r\n  };\r\n  this.instance.sendMessage(this.Event.SendAudioMessage, param);\r\n};\r\n\r\nSocket.sendImage = function (userId, image) {\r\n  cc.assert(userId);\r\n  cc.assert(image);\r\n  let param = {\r\n    \"msg\": image,\r\n    \"userId\": userId,\r\n  };\r\n  this.instance.sendMessage(this.Event.SendImage, param);\r\n};\r\n\r\nSocket.sendGetRecrod = function (userId) {\r\n  cc.assert(userId);\r\n  let param = {\r\n    \"userId\": userId,\r\n  };\r\n  this.instance.sendMessage(this.Event.GetRecord, param);\r\n};\r\n\r\nSocket.sendGetRecrodFromId = function(recordId){\r\n  let param = {\r\n    \"recordId\":recordId,\r\n  };\r\n  this.instance.sendMessage(this.Event.RecordId,param);\r\n};\r\n\r\nSocket.sendDissolveDesk = function (userId) {\r\n  cc.assert(userId);\r\n  let param = {\r\n    \"userId\": userId,\r\n  };\r\n  this.instance.sendMessage(this.Event.DissolveDesk, param);\r\n};\r\n\r\nSocket.sendGetItemRecord = function (userId, parentId) {\r\n  cc.assert(userId);\r\n  cc.assert(parentId);\r\n  let param = {\r\n    \"userId\": userId,\r\n    \"parentId\": parentId,\r\n  };\r\n\r\n  this.instance.sendMessage(this.Event.GetItemRecord, param);\r\n};\r\n\r\n//获取代开房记录\r\nSocket.sendGetDaiKaiFang = function (userId) {\r\n  cc.assert(userId);\r\n  let param = {\r\n    \"userId\": userId\r\n  };\r\n\r\n  this.instance.sendMessage(this.Event.GetDaiKaiDesk, param);\r\n};\r\n\r\nSocket.sendLeaveDesk = function (userId) {\r\n    cc.assert(userId);\r\n    let param = {\r\n      \"userId\": userId,\r\n    };\r\n\r\n    this.instance.sendMessage(this.Event.LeaveDesk, param);\r\n},\r\n\r\n/**\r\n * 回答退房请求\r\n * \r\n * @param  {Number} userId 当前用户 id\r\n * @param  {NUmber} answer=1 回答。1 表示同意； 0 表示拒绝； -1 表示未选择\r\n */\r\nSocket.sendAnswerDissolve = function (userId, answer = 0) {\r\n  cc.assert(userId);\r\n  let param = {\r\n    \"userId\": userId,\r\n    \"answer\": answer\r\n  };\r\n\r\n  this.instance.sendMessage(this.Event.AnswerDissolve, param);\r\n},\r\n\r\n  Socket.sendForceExitRoom = function (userId) {\r\n    cc.assert(userId);\r\n    let param = {\r\n      \"userId\": userId,\r\n    };\r\n\r\n    this.instance.sendMessage(this.Event.DissolveDesk, param);\r\n  },\r\n\r\n  // 十三张中\r\n  // cardInfo 类似于：\r\n  // [{\r\n  //         'cards':[{'suit':suit,'number':number},{}],//特殊牌不用传\r\n  //         'type':0,\r\n  //         'value':4,\r\n  //         'isContainExtra':true,// 特殊牌是否包含特殊牌\r\n  //     },\r\n  //     {\r\n  //         'cards':[{'suit':suit,'number':number},{}],\r\n  //         'type':0,\r\n  //         'value':4\r\n  //     }]\r\nSocket.sendPlayCard = function (userId, cardInfo) {\r\n    cc.assert(userId);\r\n    let param = {\r\n      \"userId\": userId,\r\n      \"card\": cardInfo\r\n    };\r\n\r\n    this.instance.sendMessage(this.Event.PlayCard, param);\r\n};\r\n\r\nSocket.sendTimeoutDissolve = function (userId) {\r\n  cc.assert(userId);\r\n  let param = {\r\n    \"userId\": userId,\r\n  };\r\n\r\n  this.instance.sendMessage(this.Event.TimeoutDissolve, param);\r\n};\r\n\r\nSocket.sendFeedback = function (userId, text) {\r\n  cc.assert(userId);\r\n  cc.assert(text);\r\n  let param = {\r\n    \"userId\": userId,\r\n    \"text\": text\r\n  };\r\n\r\n  this.instance.sendMessage(this.Event.Feedback, param);\r\n}\r\n\r\nSocket.sendSharePng = function (userId) {\r\n  cc.assert(userId);\r\n  let param = {\r\n    \"userId\": userId,\r\n  };\r\n  this.instance.sendMessage(this.Event.SharePng, param);\r\n};\r\n// 开始匹配随机场\r\nSocket.sendEnterRandom = function (userId) {\r\n  cc.assert(userId);\r\n  let param = {\r\n    \"userId\": userId,\r\n  };\r\n\r\n  this.instance.sendMessage(this.Event.EnterRandom, param);\r\n};\r\n\r\n// 取消匹配随机场\r\nSocket.sendCancelRandom = function (userId) {\r\n  cc.assert(userId);\r\n  let param = {\r\n    \"userId\": userId,\r\n  };\r\n\r\n  this.instance.sendMessage(this.Event.CancelRandom, param);\r\n};\r\n\r\n// 准备\r\nSocket.sendReady = function (userId) {\r\n    cc.assert(userId);\r\n    let param = {\r\n      \"userId\": userId,\r\n    };\r\n\r\n    this.instance.sendMessage(this.Event.Ready, param);\r\n  },\r\n    Socket.sendStartGame = function (userId) {\r\n      cc.assert(userId);\r\n      let param = {\r\n        \"userId\": userId,\r\n      };\r\n      cc.log(this.Event.StartGame)\r\n      cc.log()\r\n      this.instance.sendMessage(this.Event.StartGame, param);\r\n    },\r\n\r\n// 获取大厅信息\r\nSocket.sendGetHallInfo = function (userId) {\r\n    let param = {\r\n      \"userId\": userId,\r\n    };\r\n\r\n    this.instance.sendMessage(this.Event.GetHallInfo, param);\r\n},\r\n\r\n// 获取用户信息\r\nSocket.sendGetUserInfo = function (userId, openId) {\r\n    let param = {\r\n      \"userId\": userId,\r\n      \"openId\": openId,\r\n    };\r\n\r\n    this.instance.sendMessage(this.Event.GetUserInfo, param);\r\n},\r\n\r\nmodule.exports = Socket;"
  ]
}